Game.utils={},Game.utils.add_default=function(e,a){"undefined"==typeof e&&(e=a)},function(){var e,a,t,n;Game.utils.point_to=function(n,r,i,o){return e=i-n,a=o-r,t=Math.atan2(a,e)},Game.utils.normalize=function(t,r,i,o){return e=i-t,a=o-r,n=e*e+a*a,n=Math.sqrt(n),[e/n,a/n]},Game.utils.randomize_direction=function(){return Game.utils.normalize(0,0,10*Math.random()-5,10*Math.random()-5)},Game.utils.proximity=function(t,n){return e=n.transform.position.x-t.transform.position.x,a=n.transform.position.y-t.transform.position.y,Math.sqrt(e*e+a*a)},Game.utils.collision=function(e,a){return Game.utils.proximity(e,a)<e.col+a.col}}(),function(){var e=0;Game.utils.assign_id=function(){return e++}}(),Game.utils.cool_off=function(e,a){e.cooldown_left-=1e3*a,e.cooldown_left=e.cooldown_left<0?0:e.cooldown_left},Game.utils.damage=function(e,a){e.hp-=a,e.hp>e.max_hp?e.hp=e.max_hp:e.hp<=0&&(e.hp=0,e.die())},Game.utils.clone=function(e){if(null==e||"object"!=typeof e)return e;var a=e.constructor();for(var t in e)e.hasOwnProperty(t)&&(a[t]=e[t]);return a},Game.graphics={},Game.graphics.canvas=document.getElementById(Game.config.canvas_id),Game.graphics.fps_counter=document.getElementById(Game.config.fps_counter_id),Game.graphics.context=Game.graphics.canvas.getContext("2d"),Game.graphics.draw_list=[],Game.graphics.image=document.createElement("img"),Game.graphics.image.src="images.png";var image_loaded=!1;Game.graphics.draw=function(e){image_loaded||Game.graphics.image.width&&(image_loaded=!0),e.clearRect(0,0,Game.graphics.canvas.width,Game.graphics.canvas.height);var a,t,n;Game.graphics.draw_list=Game.graphics.draw_list.filter(function(r){return r.visible?(e.save(),a=r.position.x,t=r.position.y,n=r.rotation.z+-1.570796327*r.offset.r,e.translate(a,t),e.rotate(n),e.translate(-a,-t),e.drawImage(Game.graphics.image,r.offset.x,r.offset.y,r.width,r.height,r.position.x-r.width/2,r.position.y-r.height/2,r.width,r.height),e.restore(),!0):!1}),e.save(),e.strokeStyle="#555555 4px solid",e.font="bold 20px sans-serif",e.fillStyle="#F2392C",e.fillRect(50,10,200*(Game.player.hp/Game.player.max_hp),20),e.strokeRect(50,10,200,20),e.fillStyle="rgba(0,0,0,0.5)",e.fillText("HEALTH:   "+Game.player.hp,85,27),e.fillStyle="#968E59",Game.player.ranged.reload_time_left?(e.fillRect(300,10,200-200*(Game.player.ranged.reload_time_left/Game.player.ranged.reload_time),20),e.fillStyle="rgba(0,0,0,0.5)",e.fillText("RELOADING...",335,27)):(e.fillRect(300,10,200*(Game.player.ranged.ammo/Game.player.ranged.max_ammo),20),e.fillStyle="rgba(0,0,0,0.5)",e.fillText("AMMO:   "+Game.player.ranged.ammo,335,27)),e.strokeRect(300,10,200,20),e.restore()},Game.input={},Game.input.keyboard={},Game.input.keyboard.a=!1,Game.input.keyboard.s=!1,Game.input.keyboard.d=!1,Game.input.keyboard.w=!1,Game.input.keyboard.space=!1,Game.input.mouse={},Game.input.mouse.x=0,Game.input.mouse.y=0,Game.input.mouse.left=!1,Game.input.mouse.right=!1,Game.input.keyboard.id_to_key={"U+0041":"a","U+0053":"s","U+0044":"d","U+0057":"w","U+0020":"space"},Game.graphics.canvas.addEventListener("mousedown",function(e){switch(!e.which&&e.button&&(1&e.button?e.which=1:4&e.button?e.which=2:2&e.button&&(e.which=3)),e.button||e.which){case 1:Game.input.mouse.left=!0;break;case 2:Game.input.mouse.right=!0;break;case 3:}e.preventDefault()}),window.addEventListener("mouseup",function(e){switch(!e.which&&e.button&&(1&e.button?e.which=1:4&e.button?e.which=2:2&e.button&&(e.which=3)),e.button||e.which){case 1:Game.input.mouse.left=!1;break;case 2:Game.input.mouse.right=!1;break;case 3:}}),Game.graphics.canvas.addEventListener("mousemove",function(e){Game.input.mouse.x=e.x-Game.graphics.canvas.offsetLeft,Game.input.mouse.y=e.y-Game.graphics.canvas.offsetTop}),window.addEventListener("keydown",function(e){Game.input.keyboard[Game.input.keyboard.id_to_key[e.keyIdentifier]]=!0}),window.addEventListener("keyup",function(e){Game.input.keyboard[Game.input.keyboard.id_to_key[e.keyIdentifier]]=!1}),Game.player={luck:100,hp:10,max_hp:10,health_regen:1,health_regen_time:5e3,speed:200,selected_attack:"ranged",melee:{damage:4,reach:10,cooldown:500,cooldown_left:0},ranged:{damage:3,speed:750,cooldown:500,cooldown_left:0,ammo:6,max_ammo:6,reload_time:5e3,reload_time_left:0},bomb:{damage:10,range:25,cooldown:1e4,cooldown_left:0},transform:{visible:!0,position:{x:100,y:100,z:1},rotation:{x:0,y:0,z:.5},scale:{x:4,y:4},offset:{x:0,y:0,r:1},width:40,height:36}},Game.graphics.draw_list.push(Game.player.transform),Game.player.die=function(){console.log(this.hp)},Game.update_player=function(e,a){Game.input.keyboard.a&&(e.transform.position.x-=e.speed*a),Game.input.keyboard.d&&(e.transform.position.x+=e.speed*a),Game.input.keyboard.w&&(e.transform.position.y-=e.speed*a),Game.input.keyboard.s&&(e.transform.position.y+=e.speed*a),e.transform.rotation.z=Game.utils.point_to(e.transform.position.x,e.transform.position.y,Game.input.mouse.x,Game.input.mouse.y),Game.utils.cool_off(e.melee,a),Game.utils.cool_off(e.ranged,a),Game.utils.cool_off(e.bomb,a),0==e.ranged.reload_time_left?Game.input.mouse.left&&e.do_ranged(e):(e.ranged.reload_time_left-=1e3*a,e.ranged.reload_time_left<0&&(e.ranged.reload_time_left=0)),e.hp<e.max_hp&&(e.health_regen_time-=1e3*a)<0&&(Game.utils.damage(e,-1),e.health_regen_time+=5e3/e.health_regen)},Game.player.do_ranged=function(e){0==e.ranged.cooldown_left&&(e.ranged.ammo--,Game.projectiles.push({source:e,power:e.ranged.damage,type:"vector",speed:e.ranged.speed,vol:Game.utils.normalize(e.transform.position.x,e.transform.position.y,Game.input.mouse.x,Game.input.mouse.y),range:250,transform:{visible:!0,position:{x:e.transform.position.x,y:e.transform.position.y,z:e.transform.position.z},rotation:{x:0,y:0,z:.5},scale:{x:4,y:4},offset:{x:4,y:4,r:1},width:12,height:12},col:6}),Game.graphics.draw_list.push(Game.projectiles[Game.projectiles.length-1].transform),0==e.ranged.ammo&&(e.ranged.ammo=e.ranged.max_ammo,e.ranged.reload_time_left=e.ranged.reload_time),e.ranged.cooldown_left=e.ranged.cooldown)},Game.enemies=[],Game.enemy_stats={lame_brain:{health:6,speed:70,attack:"melee_1",damage:1,movement:"wonder",graphic:[220,44,32,40,0]}},Game.spawn_enemy=function(e,a,t){var n=Game.utils.clone(e);n.transform={visible:!0,position:{x:a,y:t,z:1},rotation:{x:0,y:0,z:0},scale:{x:4,y:4},offset:{x:n.graphic[0],y:n.graphic[1],r:n.graphic[4]},width:n.graphic[2],height:n.graphic[3]},n.vol=[0,0],n.col=14,n.wonder=0,n.standing=500,n.chasing=!1,n.attack_wind_up=500,n.attack_wind_up_left=500,Game.enemies.push(n),Game.graphics.draw_list.push(n.transform)},Game.spawn_enemy(Game.enemy_stats.lame_brain,500,100),Game.update_enemies=function(e){Game.enemies=Game.enemies.filter(function(a){return a.chasing=Game.utils.proximity(a,Game.player)<200,a.chasing?Game.utils.proximity(a,Game.player)<20?(a.vol=[0,0],a.attack_wind_up_left-=1e3*e,a.attack_wind_up_left<0&&(Game.utils.damage(Game.player,a.damage),a.attack_wind_up_left=a.attack_wind_up)):a.vol=Game.utils.normalize(a.transform.position.x,a.transform.position.y,Game.player.transform.position.x,Game.player.transform.position.y):a.standing?(a.standing-=1e3*e,a.standing<=0&&(a.standing=0,a.vol=Game.utils.randomize_direction(),a.wonder=275*Math.random()+75)):a.wonder&&(a.wonder-=a.speed*e,a.wonder<=0&&(a.wonder=0,a.vol=[0,0],a.standing=250*Math.random()+500)),a.transform.position.x+=a.vol[0]*a.speed*e,a.transform.position.y+=a.vol[1]*a.speed*e,!0})},function(){Game.projectiles=[];var e;Game.update_projectiles=function(a){Game.projectiles=Game.projectiles.filter(function(t){switch(e=!0,t.type){case"vector":t.transform.position.x+=t.vol[0]*t.speed*a,t.transform.position.y+=t.vol[1]*t.speed*a,t.range-=t.speed*a}for(var n=0;n<Game.enemies.length;n++)if(Game.utils.collision(t,Game.enemies[n])){console.log("HIT!"),e=!1;break}return t.range<0&&(e=!1),t.transform.visible=e})}}(),window.onload=function(){document.oncontextmenu=document.body.oncontextmenu=function(){return!1},Game.utils.add_default(Game.config,{}),Game.utils.add_default(Game.config.fps,60),Game.utils.add_default(Game.config.canvas_id,"game_canvas"),Game.utils.add_default(Game.config.fps_counter_id,"fps_counter"),Game.update=function(e){Game.update_player(Game.player,e),Game.update_projectiles(e),Game.update_enemies(e)},Game.run=function(){var e=1e3/Game.config.fps;return start_tick=next_tick=last_tick=(new Date).getTime(),num_frames=0,function(){for(current_tick=(new Date).getTime();current_tick>next_tick;)delta=(current_tick-last_tick)/1e3,Game.update(delta),next_tick+=e,last_tick=(new Date).getTime();Game.graphics.draw(Game.graphics.context),fps=1e3*(num_frames/(current_tick-start_tick)),Game.graphics.fps_counter.textContent=Math.round(fps),num_frames++}}(),window.each_frame=window.webkitRequestAnimationFrame?function(e){var a=function(){e(),webkitRequestAnimationFrame(a)};a()}:window.mozRequestAnimationFrame?function(e){var a=function(){e(),mozRequestAnimationFrame(a)};a()}:function(e){setInterval(e,1e3/Game.config.fps)},window.each_frame(Game.run)};